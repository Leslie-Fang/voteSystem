var express=require("express"),router=express.Router(),user=require("./user.js"),my=require("../databases/mysql_api");router.use(function(e,r,t){var o=e.headers["x-forwarded-for"]||e.connection.remoteAddress||e.socket.remoteAddress||e.connection.socket.remoteAddress,n=e.url;console.log("TIMEï¼š"+Date.now()+"; URL: "+n+"; IP"+o),t()}),router.get("/",function(e,r){r.render("main")}),router.use("/voter",function(e,r,t){1==e.cookies.islogin?t():r.redirect("/")}),router.get("/voter",function(e,r){r.render("voter")}),router.get("/leave",function(e,r){r.render("leave")}),router.post("/login",function(e,r,t){var o=e.param("code");my.validate(e,o,r,function(e){if("novoter"==e.state)return r.send(e);t()})},function(e,r){var t=e.param("code");my.checkoutuniq(e,t,r,function(e){return r.send(e)})}),router.post("/submitItem",function(e,r){var t=e.param("selectItem");my.insertSelectItem(e,t,r,function(e){return r.send(e)})}),router.post("/queryvotedornot",function(e,r){var t=e.param("selectItem");my.queryVotedornot(e,t,r,function(e){return r.send(e)})}),router.post("/queryresult",function(e,r){var t=e.param("type");my.queryResult(e,t,r,function(e){return r.send(e)})}),router.use("/user",user),module.exports=router;